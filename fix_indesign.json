{
  "name": "fix_indesign",
  "title": "Fix InDesign Files",
  "version": "1.0.0",
  "desc": "Specialized remediation preset for PDFs exported from Adobe InDesign. The preset fixes common structural, table, annotation, and PDF/UA issues introduced by InDesign exports and is intended to be used on top of the default PDF/UA remediation workflow.",
  "actions": [

    {
      "name": "artifact_content",
      "title": "Artifact Untagged Content",
      "desc": "Mark untagged page content without MCIDs as artifacts. InDesign exports often contain decorative or background elements that are not part of the logical structure and must be ignored by assistive technologies.",
      "params": [
        {
          "name": "object_types",
          "value": {
            "template": {
              "object_update": [
                {
                  "query": {
                    "$and": [
                      { "$0_artifact": "false" },
                      { "$0_mcid": "-1" }
                    ],
                    "param": ["pds_object"]
                  },
                  "statement": "$if"
                }
              ]
            }
          }
        },
        {
          "name": "artifact_type",
          "value": 0
        }
      ]
    },

    {
      "name": "rename_tags",
      "title": "Rename Table Cells (TD â†’ TH in First Column)",
      "desc": "Convert table data cells (TD) in the first column to header cells (TH). InDesign frequently exports header columns incorrectly as TD, which breaks table semantics and PDF/UA compliance.",
      "params": [
        {
          "name": "tag_names",
          "value": {
            "template": {
              "tag_update": [
                {
                  "query": {
                    "$and": [
                      {
                        "$0_tag_type": {
                          "$regex": "^TD$"
                        }
                      },
                      {
                        "$0_cell_column": "1"
                      }
                    ],
                    "param": ["pds_struct_elem"]
                  },
                  "statement": "$if"
                }
              ]
            }
          }
        },
        {
          "name": "tag_name",
          "value": "TH"
        }
      ]
    },

    {
      "name": "set_structure_attribute",
      "title": "Set Table Header Scope (Row headers)",
      "desc": "Assign the Table Scope attribute to header cells in the first column, marking them as row headers. This resolves common InDesign table accessibility issues where header relationships are missing.",
      "params": [
        {
          "name": "tag_names",
          "value": {
            "template": {
              "tag_update": [
                {
                  "query": {
                    "$and": [
                      {
                        "$0_tag_type": {
                          "$regex": "^TH$"
                        }
                      },
                      {
                        "$0_cell_column": "1"
                      }
                    ],
                    "param": ["pds_struct_elem"]
                  },
                  "statement": "$if"
                }
              ]
            }
          }
        },
        {
          "name": "owner",
          "value": "Table"
        },
        {
          "name": "name",
          "value": "Scope"
        },
        {
          "name": "value",
          "value": "Row"
        },
        {
          "name": "value_type",
          "value": "name"
        },
        {
          "name": "overwrite",
          "value": false
        }
      ]
    },

    {
      "name": "set_tag_id",
      "title": "Set Tag IDs (Note)",
      "desc": "Generate unique ID keys for Note structure elements. InDesign exports frequently omit Note IDs, which is a direct PDF/UA failure.",
      "params": [
        {
          "name": "tag_names",
          "value": "^Note$"
        },
        {
          "name": "overwrite",
          "value": false
        }
      ]
    },

    {
      "name": "set_annot_contents",
      "title": "Set Annotation Contents (Text from BBox)",
      "desc": "Populate annotation alternative text using text extracted from the annotation bounding box. This improves accessibility of links and markup annotations generated by InDesign.",
      "params": [
        {
          "name": "annot_types",
          "value": "^Link$|^Highlight$|^Underline$|^Squiggly$|^StrikeOut$"
        },
        {
          "name": "alt_type",
          "value": 1
        },
        {
          "name": "custom_text",
          "value": "Link annotation pointing somewhere"
        },
        {
          "name": "bbox_padding_x",
          "value": 4
        },
        {
          "name": "bbox_padding_x_right",
          "value": 4
        },
        {
          "name": "bbox_padding_y_top",
          "value": 4
        },
        {
          "name": "bbox_padding_y",
          "value": 4
        },
        {
          "name": "overwrite",
          "value": false
        }
      ]
    },

    {
      "name": "set_pdf_ua_standard",
      "title": "Set PDF/UA-1 Identifier",
      "desc": "Explicitly declare PDF/UA-1 conformance in the document metadata. InDesign exports often miss or incorrectly define the PDF/UA identifier.",
      "params": [
        {
          "name": "part_number",
          "value": "1"
        }
      ]
    }

  ]
}
